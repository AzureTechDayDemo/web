version: 1.0-preview-1
steps:
  - build: -t {{.Run.Registry}}/demo42/web:{{.Run.ID}}  --file ./src/WebUI/Dockerfile --build-arg REGISTRY_NAME={{.Run.Registry}}/ .
  #- build: -t demo42.azurecr.io/demo42/web:{{.Run.ID}}  --file ./src/WebUI/Dockerfile --build-arg REGISTRY_NAME={{.Run.Registry}}/ .
  #- push: {{.Run.Registry}}/demo42/web:{{.Run.ID}}
  - cmd: docker push {{.Run.Registry}}/demo42/web:{{.Run.ID}}
  #- cmd: docker login demo42.azurecr.io -u {{.Values.REGISTRY_USR}} -p {{.Values.REGISTRY_PWD}}
  #- cmd: docker push demo42.azurecr.io/demo42/web:{{.Run.ID}}
  #- cmd: cmd.azurecr-test.io/helm:v2.11.0-rc.2 upgrade demo42 ./helm/importantThings --reuse-values --set web.image=demo42.azurecr.io/demo42/web:{{.Run.ID}}
  - cmd: cmd.azurecr-test.io/helm:v2.11.0-rc.2 upgrade demo42 ./helm/importantThings --reuse-values --set web.image={{.Run.Registry}}/demo42/web:{{.Run.ID}}
    env:
      - TENANT={{.Values.TENANT}}
      - SP={{.Values.SP}}
      - PASSWORD={{.Values.PASSWORD}}
      - CLUSTER_RESOURCE_GROUP={{.Values.CLUSTER_RESOURCE_GROUP}}
      - CLUSTER_NAME={{.Values.CLUSTER_NAME}}
  
